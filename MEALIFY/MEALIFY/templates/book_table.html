<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Basic HTML setup for the page -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Link to our custom CSS file -->
    <link rel="stylesheet" href="{{ url_for('static', filename='STYLE.css') }}">
    
    <!-- Link to Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    
    <!-- Page title shown in browser tab -->
    <title>Book a Table - Mealify</title>
</head>
<body>

<!-- Navigation bar at the top of the page -->
<nav class="navbar">
    <!-- Restaurant logo/name -->
    <div class="logo">Mealify.</div>
    
    <!-- Navigation links menu -->
    <ul class="nav-links">
        <!-- Home page link with house icon -->
        <li><a href="{{ url_for('index') }}"><i class="fas fa-home"></i> Home</a></li>
        
        <!-- Food ordering page link with utensils icon -->
        <li><a href="{{ url_for('order') }}"><i class="fas fa-utensils"></i> Order Food</a></li>
        
        <!-- Current page (table booking) marked as active -->
        <li><a href="{{ url_for('book_table') }}" class="active">
            <i class="fas fa-calendar-alt"></i> Book Table
        </a></li>
        
        <!-- Show logout button if user is logged in, otherwise show login button -->
        {% if user %}
            <li><a href="{{ url_for('logout') }}"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
        {% else %}
            <li><a href="{{ url_for('login') }}"><i class="fas fa-sign-in-alt"></i> Login</a></li>
        {% endif %}
    </ul>
    
    <!-- Hidden checkbox for dark mode toggle -->
    <input type="checkbox" id="darkToggle" hidden>
    
    <!-- Dark mode toggle button with moon and sun icons -->
    <label for="darkToggle" class="dark-btn">
      <i class="fa-solid fa-moon"></i>
      <i class="fa-solid fa-sun"></i>
    </label>
</nav>

<!-- Main content container -->
<div class="container">
    <!-- White card containing the booking form -->
    <div class="booking-card">
        
        <!-- Header section with title and subtitle -->
        <div class="booking-header">
            <h1><i class="fas fa-calendar-alt"></i> Reserve Your Table</h1>
            <p class="booking-subtitle">Book a table for an unforgettable dining experience</p>
        </div>
        
        <!-- Display flash messages (success/error notifications) -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-container">
                    <!-- Loop through all messages -->
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">
                            <!-- Show different icons based on message type -->
                            <i class="fas fa-{% if category == 'success' %}check-circle{% elif category == 'danger' %}exclamation-circle{% else %}info-circle{% endif %}"></i>
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        
        <!-- Main booking form that sends data to server -->
        <form method="POST" class="booking-form">
            
            <!-- Section 1: Personal information -->
            <div class="form-section">
                <h3><i class="fas fa-user"></i> Personal Information</h3>
                <div class="form-group">
                    <label for="name">Full Name *</label>
                    <div class="input-with-icon">
                        <i class="fas fa-user"></i>
                        <!-- Name field, auto-filled with username if logged in -->
                        <input type="text" id="name" name="name" 
                               value="{{ user.username if user }}" 
                               placeholder="Enter your full name" required>
                    </div>
                </div>
            </div>

            <!-- Section 2: Table selection -->
            <div class="form-section">
                <h3><i class="fas fa-chair"></i> Table Selection</h3>
                <p class="form-help">Choose your preferred table (1-10)</p>
                <div class="table-selection">
                    <!-- Generate 10 table options using loop -->
                    {% for i in range(1, 11) %}
                    <div class="table-option-wrapper">
                        <!-- Hidden radio button for table selection -->
                        <input type="radio" id="table{{ i }}" name="table" value="{{ i }}" required>
                        
                        <!-- Visible table card that user clicks -->
                        <label for="table{{ i }}" class="table-label">
                            <span class="table-icon"><i class="fas fa-table"></i></span>
                            <span class="table-number">Table {{ i }}</span>
                            <span class="table-capacity"><i class="fas fa-user-friends"></i> 4 seats</span>
                        </label>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Section 3: Time selection -->
            <div class="form-section">
                <h3><i class="fas fa-clock"></i> Time Selection</h3>
                <div class="time-selection">
                    <!-- Time input field -->
                    <div class="form-group time-group">
                        <label for="time">Preferred Time *</label>
                        <div class="input-with-icon">
                            <i class="fas fa-clock"></i>
                            <!-- Time picker with restaurant hours restriction -->
                            <input type="time" id="time" name="time" 
                                   min="11:00" max="22:00" 
                                   value="19:00" required>
                        </div>
                        <small class="time-note"><i class="fas fa-info-circle"></i> Restaurant hours: 11:00 AM - 10:00 PM</small>
                    </div>
                    
                    <!-- Quick time slot buttons -->
                    <div class="time-slots">
                        <div class="slot-header">Popular Time Slots:</div>
                        <div class="slot-buttons">
                            <!-- Buttons to quickly select popular times -->
                            <button type="button" class="slot-btn" data-time="12:00">12:00 PM</button>
                            <button type="button" class="slot-btn" data-time="14:00">2:00 PM</button>
                            <button type="button" class="slot-btn" data-time="19:00">7:00 PM</button>
                            <button type="button" class="slot-btn" data-time="20:30">8:30 PM</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action buttons at bottom of form -->
            <div class="form-actions">
                <!-- Submit button to book the table -->
                <button type="submit" class="btn-submit">
                    <i class="fas fa-calendar-check"></i> Confirm Reservation
                </button>
                
                <!-- Cancel button to return to home page -->
                <a href="{{ url_for('index') }}" class="btn-cancel">
                    <i class="fas fa-times"></i> Cancel
                </a>
            </div>
            
            <!-- Information/notes section -->
            <div class="booking-info">
                <p><i class="fas fa-exclamation-circle"></i> You will receive a confirmation email for your booking.</p>
                <p><i class="fas fa-clock"></i> Please arrive 15 minutes before your reservation time.</p>
            </div>
        </form>
    </div>
</div>

<!-- JavaScript for interactive features -->
<script>
  // DARK MODE FEATURE
  
  // Get the dark mode toggle element
  const darkToggle = document.getElementById('darkToggle');
  
  // Check if user previously selected dark mode
  const savedMode = localStorage.getItem('darkMode');
  
  // If dark mode was saved, apply it
  if (savedMode === 'true') {
    document.body.classList.add('dark-mode');
    if (darkToggle) darkToggle.checked = true;
  }
  
  // When user toggles dark mode switch
  if (darkToggle) {
    darkToggle.addEventListener('change', function() {
      // Toggle dark mode class on body
      document.body.classList.toggle('dark-mode', this.checked);
      
      // Save user's preference in browser storage
      localStorage.setItem('darkMode', this.checked);
    });
  }

  // TIME SLOT BUTTONS FEATURE
  
  // Make all time slot buttons clickable
  document.querySelectorAll('.slot-btn').forEach(btn => {
      btn.addEventListener('click', function() {
          // Get the time from button's data attribute
          const time = this.getAttribute('data-time');
          
          // Set the time input field to selected time
          document.getElementById('time').value = time;
          
          // Remove active styling from all buttons
          document.querySelectorAll('.slot-btn').forEach(b => {
              b.classList.remove('active');
          });
          
          // Add active styling to clicked button
          this.classList.add('active');
      });
  });
  
  // PAGE LOAD SETUP
  
  // When page finishes loading
  document.addEventListener('DOMContentLoaded', function() {
      // Select table 4 by default
      const table4 = document.getElementById('table4');
      if (table4) table4.checked = true;
      
      // Highlight 7:00 PM time slot by default
      const sevenPmBtn = document.querySelector('.slot-btn[data-time="19:00"]');
      if (sevenPmBtn) sevenPmBtn.classList.add('active');
  });
</script>

</body>
</html>